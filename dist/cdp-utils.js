var C=Object.create;var m=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var U=(e,t)=>()=>(e&&(t=e(e=0)),t);var p=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),F=(e,t)=>{for(var i in t)m(e,i,{get:t[i],enumerable:!0})},w=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of q(t))!N.call(e,o)&&o!==i&&m(e,o,{get:()=>t[o],enumerable:!(r=k(t,o))||r.enumerable});return e};var L=(e,t,i)=>(i=e!=null?C(A(e)):{},w(t||!e||!e.__esModule?m(i,"default",{value:e,enumerable:!0}):i,e)),O=e=>w(m({},"__esModule",{value:!0}),e);var u=U(()=>{});var v=p((X,g)=>{u();function s(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}g.exports=s;s.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};s.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};s.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var i=this._timeouts.shift();if(i===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),i=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},i),this._options.unref&&this._timer.unref(),!0};s.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};s.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)};s.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)};s.prototype.start=s.prototype.try;s.prototype.errors=function(){return this._errors};s.prototype.attempts=function(){return this._attempts};s.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,i=0,r=0;r<this._errors.length;r++){var o=this._errors[r],n=o.message,a=(e[n]||0)+1;e[n]=a,a>=i&&(t=o,i=a)}return t}});var x=p(c=>{u();var P=v();c.operation=function(e){var t=c.timeouts(e);return new P(t,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};c.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in e)t[i]=e[i];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],o=0;o<t.retries;o++)r.push(this.createTimeout(o,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(o,t)),r.sort(function(n,a){return n-a}),r};c.createTimeout=function(e,t){var i=t.randomize?Math.random()+1:1,r=Math.round(i*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout),r};c.wrap=function(e,t,i){if(t instanceof Array&&(i=t,t=null),!i){i=[];for(var r in e)typeof e[r]=="function"&&i.push(r)}for(var o=0;o<i.length;o++){var n=i[o],a=e[n];e[n]=function(I){var h=c.operation(t),l=Array.prototype.slice.call(arguments,1),M=l.pop();l.push(function(T){h.retry(T)||(T&&(arguments[0]=h.mainError()),M.apply(this,arguments))}),h.attempt(function(){I.apply(e,l)})}.bind(e,a),e[n].options=t}}});var b=p((j,E)=>{u();E.exports=x()});var H={};F(H,{hideNode:()=>Y,querySelector:()=>$,screenshotNode:()=>G,waitForNetworkIdle:()=>W,xpath:()=>V});module.exports=O(H);u();u();var S=L(b(),1),D=new Set(["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed"]),_=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}},z=(e,t,i)=>{let r=i.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=r,e},B=e=>D.has(e),R=e=>globalThis.DOMException===void 0?new Error(e):new DOMException(e);async function d(e,t){return new Promise((i,r)=>{t={onFailedAttempt(){},retries:10,...t};let o=S.default.operation(t);o.attempt(async n=>{try{i(await e(n))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof _)o.stop(),r(a.originalError);else if(a instanceof TypeError&&!B(a.message))o.stop(),r(a);else{z(a,n,t);try{await t.onFailedAttempt(a)}catch(y){r(y);return}o.retry(a)||r(o.mainError())}}}),t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",()=>{o.stop();let n=t.signal.reason===void 0?R("The operation was aborted."):t.signal.reason;r(n instanceof Error?n:R(n))},{once:!0})})}var W=(e,t)=>new Promise(i=>{let r=new Set,o=setTimeout(i,t);e.requestWillBeSent(({requestId:n})=>{r.add(n),clearTimeout(o)}),e.loadingFinished(({requestId:n})=>{r.delete(n),r.size===0&&(o=setTimeout(i,t))})}),J=e=>new Promise(t=>{setTimeout(t,e)}),$=async(e,t,i)=>await d(async()=>{let{nodeId:r}=await e.querySelector({nodeId:t,selector:i});if(r===0)throw new Error(`Selector "${i}" not found`);return r},{retries:3,onFailedAttempt:async()=>await J(100)}),V=async(e,t)=>{let{searchId:i,resultCount:r}=await e.performSearch({query:t}),{nodeIds:o}=await e.getSearchResults({searchId:i,fromIndex:0,toIndex:r});return o},Y=async(e,t)=>{await e.setAttributeValue({nodeId:t,name:"style",value:"visibility: hidden"})},G=async(e,t,i)=>{try{let{model:r}=await t.getBoxModel({nodeId:i}),o=await e.captureScreenshot({clip:{x:0,y:0,width:r.width,height:r.height,scale:1}});return Buffer.from(o.data,"base64")}catch(r){throw console.log(r),new Error("Failed to take a snapshot")}};0&&(module.exports={hideNode,querySelector,screenshotNode,waitForNetworkIdle,xpath});
